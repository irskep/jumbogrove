<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/jg/character.js | Jumbo Grove</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-app.css"><link rel="stylesheet" href="./inject/css/0-style.css"><script src="./inject/script/0-jumbogrove.js"></script><script src="./inject/script/0-script.js"></script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-4517625-7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-4517625-7');
</script><meta name="description" content="An interactive fiction game engine"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Jumbo Grove"><meta property="twitter:description" content="An interactive fiction game engine"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/irskep/jumbogrove"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-jumbogrove">jumbogrove</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#jg">jg</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/character.js~Character.html">Character</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/dataui.js~ui.html">ui</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/model.js~model.html">model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/situation.js~Situation.html">Situation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://github.com/markdown-it/markdown-it">MarkdownIt</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#jg-gameformat">jg/gameformat</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/gameformat/character.js~character.html">character</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/gameformat/game.js~game.html">game</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/jg/gameformat/situation.js~situation.html">situation</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#jg-qualities">jg/qualities</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-flag">flag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-fudgeAdjective">fudgeAdjective</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-qualities">qualities</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-integer">integer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-namedChoice">namedChoice</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-nonZeroInteger">nonZeroInteger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-onOff">onOff</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-raw">raw</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-wordScale">wordScale</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-yesNo">yesNo</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/jg/character.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import _ from &apos;lodash&apos;;
import qualities from &quot;./qualities/index&quot;;

const _prioritySort = ({priority}) =&gt; -priority || 0;
const _groupOmitKeys = [&apos;id&apos;, &apos;name&apos;, &apos;priority&apos;, &apos;hidden&apos;];

/**
 * This class is created from the character object you specify in your game.
 */
export default class Character {
    /**
     * 
     * @param {object} args 
     * @param {string} args.id
     * @param {string} args.name
     * @param {number} args.priority
     * @param {Boolean} args.showInSidebar
     * @param {string|function(): string} args.description Currently unused
     * @param {quality[]} args.qualities
     * @param {*} args.state Initial value of {@link state}
     */
    constructor({qualities, id, name, priority = 0, showInSidebar = true, description = &apos;&apos;, state = {}}) {
        /**
         * The ID you specified for this character. Must be unique across all characters.
         * @type {string}
         */
        this.id = id;

        /**
         * The name you specified for this character.
         * @type {string}
         */
        this.name = name;

        /**
         * Arbitrary, JSON-safe data about this character. You may update it any time you want.
         * @type {*}
         */
        this.state = _.cloneDeep(state); 

        Object.assign(this, {qualities, description, showInSidebar, priority});

        this.updateQualities()
    }

    /** @ignore */
    updateQualities() {
        this._shallowQualities = {};
        Object.keys(this.qualities).forEach((k) =&gt; {
            const group = this.qualities[k];
            group.id = k;
            for (const k2 of _.keys(_.omit(group, _groupOmitKeys))) {
                if (this._shallowQualities[k2]) {
                    throw Error(&quot;You have two qualities with the same ID. Please don&apos;t do that.&quot;)
                }
                group[k2].id = k2;
                this._shallowQualities[k2] = group[k2];
                if (group[k2].value === undefined) group[k2].value = group[k2].initialValue;
            }
        });
        /** @ignore */
        this.sortedQualityGroups = _.sortBy(Object.values(this.qualities), _prioritySort);
    }

    /** @ignore */
    toSave() {
        return _.pick(this, [&apos;id&apos;, &apos;qualities&apos;, &apos;name&apos;, &apos;showInSidebar&apos;, &apos;description&apos;, &apos;state&apos;]);
    }

    /** @ignore */
    loadSave(obj) {
        _.assign(this, obj);
        this.updateQualities();
    }

    /** @ignore */
    getDescription() {
        if (_.isFunction(this.description)) {
            return this.description.apply(this, arguments);
        } else {
            return this.description || this.id;
        }
    }

    /** @ignore */
    sortedQualities(groupName) {
        return _.sortBy(Object.values(_.omit(this.qualities[groupName], _groupOmitKeys)), _prioritySort);
    }

    /**
     * Return the current value of this quality (without formatting it)
     * 
     * @param {string} id ID of the quality whose value you want
     * @returns {*}
     */
    getQuality(id) {
        return this._shallowQualities[id].value;
    }

    /**
     * Return the _initial_ value of this quality from the start of the game(without formatting it).
     * You can use this to see how the value has changed since the start of the game.
     * 
     * @param {string} id ID of the quality whose value you want
     * @returns {*}
     */
    getQualityInitial(id) {
        return this._shallowQualities[id].initialValue;
    }

    /**
     * Returns the formatted value of the given quality.
     * 
     * @param {string} id ID of the quality whose value you want
     * @returns {string}
     */
    formatQuality(id) {
        const quality = this._shallowQualities[id];
        if (!qualities[quality.type]) {
            console.error(&quot;Undefined quality type:&quot;, quality.type);
            return &apos;&apos;;
        }
        return qualities[quality.type].format(this, quality, quality.value);
    }

    /**
     * Return the human-readable name for the given quality ID.
     * 
     * @param {string} id ID of the quality whose value you want
     * @returns {string}
     */
    formatQualityName(id) {
        const quality = this._shallowQualities[id];
        return quality.name;
    }

    /**
     * Qualities **must** be modified using this method.
     * 
     * @param {string} id ID of the quality to modify on this character
     * @param {*} value New value for the quality
     */
    setQuality(id, value) {
        this._shallowQualities[id].value = value;
    }

    /**
     * Add an integer value to the given quality.
     * 
     * @param {string} id ID of the quality to modify on this character
     * @param {number} delta Amount to add
     * @returns {number} The new value
     */
    addToQuality(id, delta) {
        return this._shallowQualities[id].value += delta;
    }
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
